---
title: VBA 整型变量应选用的数据类型及声明变量
categories: [note]
comments: true
---

# VBA 整型变量应选用的数据类型及声明变量

## 说明

这篇博客会记录以下两个问题：

1.   `VBA` 声明 **整型变量** 时应该选用那种 **数据类型** 更合适；
2.   一些关于 `VBA` 声明变量的问题。

## 正文

### 问题描述

在 `VBA` 中通常可以使用 `Integer` 和 `Long` 两种 **数据类型** 表示 **整数**，当需要定义一个 **变量** 用来表示 `0` 到 `100` 间的一个 **整数** 时，应该选用那种 **数据类型**  更合适呢？

| 数据类型  | 占用内存（字节） |              表示范围               |
| :-------: | :--------------: | :---------------------------------: |
| `Integer` |        2         |        `-32,768` 到 `32,767`        |
|  `Long`   |        4         | `-2,147,483,648` 到 `2,147,483,647` |

根据表格[^1]提供的信息分析。首先，无论选用那种数据类型都是可以满足要求的；然后，考虑到不同数据类型占用内存（字节）的情况有所不同；所以，综合考虑后认为选择 `Integer` 数据类型可能更合适。因为相同场景下，`Integer` 占用的内存更少。

**正确** 的答案应该是选用 `Long` 数据类型。

### 补充知识

在计算机中 `1` 个 **字节** 需要用 `8` **位** 来存储；**字节** 用单词 `byte` 表示，**位** 用单词 `bit` 表示。其中 **位** 也叫 **比特**，是计算机中最小的存储单元；用来存储两种状态：分别是 `0` 和 `1`，所以一个比特代表的值可能是 `1`，也可能是 `0`。

```
1 byte = 8 bit
```

存放在计算机中的数是使用 **二进制** 表示的，此处暂时不考虑关于数值的符号问题，日常生活中所使用的 **进制** 是 **十进制** 的。

思考一个问题：“有两个空缺的位置 `_ _`，当使用 **十进制** 表示一个数时这两个位置可以表示的最大的数是多少？”

答案显而易见：`99`。

此处可以用一个公式将表示一个数所用的 **进制** 和 **位数** 串联起来，可以求得使用 `n` 位数能够表示的最大的数。以 **十进制** 为例，用 `n` 能够表示的最大的数就是 `10` 的 `n` 次方后减 `1`，此处减去的 `1` 是 **值** `0`。

```
10^{n} - 1
```

上述公式就是一个关于 **排列组合** 的游戏，将这个公式用在 **十进制** 中并没有很大意义。但是这个公式是适用于 **其他进制** 的，例如 **二进制**、**八进制** 和 **十六进制**，此时这个公式就能发挥一些用处了。

假设给了一串只有 `16` 个位置的空格 `▢`，并且只能使用 **二进制** 表示 **十进制** 的数，请问这 `16` 个空格在不考虑 **数值符号** 的情况下，能表示的最大数值是多少？

```latex
1111, 1111, 1111, 1111
2^{16} - 1 = 65, 535
```

**二进制补码表示法**

上述能表示的最大数值是没有符号的整数，即 **无符号整数**。所以此处引入一种新的表示法——**二进制补码表示法**，用来表示 **有符号整数**。

>   几乎所有的计算机都使用 **二进制补码表示法** 来存储 `n` 位存储单元中的有符号整数。[^2]

先考虑一个问题，使用 `n` 位可以表示多少个 **无符号整数**？

```latex
% 又是一个排列组合的游戏
2^{n}
0 ~ 2^{n} - 1
```

**二进制补码表示法** 将无符号整数的有效范围分成两个相等的子范围。

假设 `n = 4`，则：

-   `0000 ~ 0111` 表示 `0 ~ 7`；
-   `1000 ~ 1111` 表示 `-8 ~ -1`。

使用 **二进制补码表示法** 要在首位（最左位）使用一个位置决定 **符号**：

-   如果首位是 `0`，该整数位 **正**；
-   如果首位是 `1`，该整数位 **负**。

>   **Note**：
>
>   布尔代数：
>
>   -   `0` 表示 `False`；
>   -   `1` 表示 `True`。

所以实际用来存储数值的位置就变成了 `n - 1` 位，一个 `16` 位（`2` 字节）的内存就只剩下 `15` 个 **位** 用来存储数了，现在 `2` 字节能表示的 **最大正整数** 就变成了。

```latex
% 最大正整数
0111, 1111, 1111, 1111
2^{15} - 1 = 32, 767

% 最小负整数
1000, 0000, 0000, 0000
-((2^{16}) / 2) = -32, 768

```

考虑两种运算：

-   反码。
-   补码。

**1. 反码**

对每一位取反 `Not`

```
原来的模式	00110110
反码运算后	11001001
反码运算后	00110110
```

**2. 补码**

1.   首先，从右复制位，直到有 `1` 被复制；
2.   接着，反转其余位。

```
原来的模式	00110100
补码运算后	11001100
补码运算后	00110100
```

**以二进制补码格式存储整数**

1.   将整数转换为 `n` 位的 **二进制数**。
2.   如果整数是正数或零，以其原样存储；如果是负数，取其补码存储。

**以二进制补码格式还原整数**

1.   如果首位是 `1`，取其 **补码**；如果首位是 `0`，不进行操作。
2.   将整数化为 **十进制数**。

### 问题解析

>   因为很多年以前，我们就开始使用32位计算机和操作系统（现在64位系统也已经普及了）。之所以叫32位系统，就是因为它在执行计算时，标准字长（可以理解为最小处理单位）就是4个字节（每个字节8位，总共32位）。所以就算你给它一个2字节数据，它也要耗用4个字节的运算资源来处理。
>
>   由于这个原因，目前的Office VBA在执行我们的代码时，会自动将所有我们声明为Integer类型（2字节）的变量，全部转换成Long类型（4字节）的变量然后再执行计算。因此可以想到，我们声明Integer类型并不会节省内存（反正到了底层都统一变成了Long），反而会多消耗一点时间（让VBA将其转换为Long）。所以在平时应用中，大家统一写Long就是了，基本可以忘记Integer的存在了。[^3]

## 变量声明

声明变量时，通常使用 `Dim` 语句。 声明语句可以置于创建过程中以创建过程级变量。 也可以置于声明部分的模块顶部，以创建模块级变量。[^4]

可以在一个语句中声明多个变量，如果要指定数据类型，必须为每个变量单独指定数据类型。

```vb
Sub demo01()

'这种定义变量的方式是一个坑啊！！！
Dim str1, str2, str3 As String

Debug.Print TypeName(str1), TypeName(str2), TypeName(str3)

End Sub

Sub demo02()

Dim str1 As String, str2 As String, str3 As String

Debug.Print TypeName(str1), TypeName(str2), TypeName(str3)

End Sub
```

```
Empty         Empty         String
String        String        String
```

类似过程 `demo01` 中定义多个变量的方式，在 `C` 语言中是可以批量指定多个变量为同一数据类型的，这种定义变量的方式是一个坑。

关于 **定义** 和 **声明** 的区别：[^5]

-   `define` 定义：创建变量或分配存储单元；
-   `declaration` 声明：说明变量的性质，但不分配存储单元。

在 `VBA` 中 **声明** 变量即 **创建** 变量，并指定变量类型和分配存储单元。

```vb
'建议使用该方式声明变量
Dim varNmae as varType
```

## 参考资料

---

[^1]: O365DEVX. 数据类型摘要[EB/OL]. (2023-08-03)[2023-09-24]. [https://learn.microsoft.com/zh-cn/office/vba/language/reference/user-interface-help/data-type-summary](https://learn.microsoft.com/zh-cn/office/vba/language/reference/user-interface-help/data-type-summary).
[^2]: （美）贝赫鲁兹·佛罗赞（BehrouzForouzan）著；吕云翔等译. 计算机科学导论 原书第4版[M]. 北京：机械工业出版社, 2020.05.
[^3]: VBA中的整数变量应该声明为Integer类型么？[EB/OL]//知乎专栏. [2023-09-24]. [https://zhuanlan.zhihu.com/p/26282980](https://zhuanlan.zhihu.com/p/26282980).
[^4]:   O365DEVX. 声明变量 (VBA)[EB/OL]. (2023-04-07)[2023-09-24]. [https://learn.microsoft.com/zh-cn/office/vba/language/concepts/getting-started/declaring-variables](https://learn.microsoft.com/zh-cn/office/vba/language/concepts/getting-started/declaring-variables).
[^5]: （美）（B.W.克尼汉）（BrianW.Kernighan），（美）（D.M.里奇）（DennisM.Ritchie）著. C程序设计语言 第2版[M]. 北京：清华大学出版社, 1998.07.
